function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=e(require("@babel/runtime-corejs3/core-js-stable/instance/bind")),r=e(require("react")),s=e(require("@babel/runtime-corejs3/core-js-stable/object/create")),a=e(require("@babel/runtime-corejs3/core-js-stable/object/assign")),n=e(require("@babel/runtime-corejs3/core-js-stable/json/stringify")),i=e(require("@babel/runtime-corejs3/core-js-stable/instance/includes")),c=e(require("@babel/runtime-corejs3/core-js-stable/instance/filter")),o=e(require("@babel/runtime-corejs3/core-js-stable/instance/flat-map")),u=e(require("@babel/runtime-corejs3/core-js-stable/instance/for-each")),l=e(require("@babel/runtime-corejs3/core-js-stable/object/keys")),h=e(require("@babel/runtime-corejs3/core-js-stable/instance/reduce")),y=e(require("@babel/runtime-corejs3/core-js-stable/symbol")),d=e(require("@babel/runtime-corejs3/core-js-stable/array/is-array")),m=e(require("fast-memoize"));const p=e=>e&&"object"==typeof e&&("function"!=typeof e.constructor||"Object"===e.constructor.name),b=(e,t,r)=>((e,t,r)=>{const s=d(t)?t:[t];let n=e;return u(s).call(s,t=>{if(!p(t))return;const s=l(t);u(s).call(s,s=>{const i=Object.hasOwnProperty.call(e,s),c=e[s],o=t[s],u=r?r(c,o,s):o;i&&u===c||(n===e&&(n=a({},e)),n[s]=u)})}),n})(e,t,(e,t,s)=>p(e)&&p(t)?b(e,t,r):r?r(e,t,s):t),j=e=>{const[t,...r]=e.split("/");return r[0]||(r[0]="/"),r},f=e=>m((t,r)=>b(t,r,e)),Q=f((e,t)=>d(e)&&d(t)?[...e,...t]:t),S=f((e,t)=>d(e)&&d(t)?c(e).call(e,(e,r)=>!i(t).call(t,e)):t),g=(e,t,r)=>{const s=Object.prototype.hasOwnProperty.call(e,t),n=e[t],i=r(n,t,{tail:!0});return s&&n===i?e:a({},e,{[t]:i})},P="@@__QUERYSTRING_CACHE_STATE_OBJECT__@@",q=y("shadow"),v=()=>Math.random().toString(36).substr(2,7),E=e=>({nested:{},persisted:{},[q]:{},...e}),x=({mutations:e,...t}={})=>({[P]:{...t,key:v(),mutations:e||[]}}),O=(e,[t,...r]=[],s=[])=>{if(t){const a=e["*"],n=e[t];return a&&a.mutated&&s.push(a),n&&n.mutated&&s.push(n),n?O(n.nested,r,s):s}return s},_=(e,t=[])=>h(t).call(t,(t,r)=>({...t,[r]:{...e[r],[q]:{},nested:_(e[r].nested,l(e[r].nested))}}),{...e}),C={get cache(){return this.history[this.currentHistoryKey]},set cache(e){this.history[this.currentHistoryKey]=e},add({pathname:e="",state:t}){const{key:r,mutations:s,foreign:n,respect:h,match:y}=t[P];if(Object.prototype.hasOwnProperty.call(this.history,r))return this.currentHistoryKey=r,this;let d=this.cache;var m;(u(s).call(s,({scope:t,persist:r,add:s,remove:i})=>{var c;d=((e,t,r,s)=>{let n,i=s||(()=>({})),c=a({},e),o=c;for(let s=0,c=t.length;s<c;s++)if(s===c-1){if(!n)return g(e,t[s],r);{const a=g(o,t[s],r);if(o===a)return e;n[t[s-1]]=a}}else{const e=r(o[t[s]]?o[t[s]]:i(t[s]),t[s],{tail:!1});o[t[s]]=a({},e),n=o,o=o[t[s]]}return c})(d,o(c=j(t||e)).call(c,(e,t,{length:r})=>t<r-1?[e,"nested"]:e),(e,t,{tail:a})=>{if(a){const a=e||E({path:t,mutated:!0});if(n)return{...a,persisted:h?a.persisted:{},[q]:h?s:{},nested:_(a.nested,l(a.nested))};{const e=r?"persisted":q;let t=a[e];return i&&(t=this.removeQueryParams(t,i)),s&&(t=this.addQueryParams(t,s)),{...a,[e]:t,nested:y?a.nested:_(a.nested,l(a.nested))}}}return n&&!h&&"nested"!==t?E({path:t,nested:e.nested}):e},e=>"nested"===e?{}:E({path:e}))}),y)||(d=_(d,c(m=l(d)).call(m,t=>{var r;return!i(r=["*",j(e)[0]]).call(r,t)})));return this.currentHistoryKey=r,this.cache=d,this},resolveQueryString(e="",t=[]){const r=O(this.cache,j(e));let s=h(r).call(r,(e,t)=>this.addQueryParams(e,{...t[q],...t.persisted}),{});return u(t).call(t,({add:e,remove:t})=>{t&&(s=this.removeQueryParams(s,t)),e&&(s=this.addQueryParams(s,e))}),this.stringifyQueryParams(s)},clear(){return this.history={},this.currentHistoryKey=v(),this.cache={},this},toString(){return n(this.cache)}};let K;const H=({initialCache:e,parseQueryString:t,stringifyQueryParams:r,addQueryParams:n,removeQueryParams:i}={})=>{if(!K){const c=v();K=a(s(a(C,{createStateObject:x,parseQueryString:t,stringifyQueryParams:r,addQueryParams:n||Q,removeQueryParams:i||S})),{currentHistoryKey:c,history:{[c]:e||{}}})}return K},T=r.createContext({}),Y=(e,{pathname:t,mutations:r,hash:s,state:a={}},{stringify:n})=>{const i=e.resolveQueryString(t,r),c={...a,...e.createStateObject({mutations:r,...a[P]})};return n?{path:`${t}${i}${s}`,state:c}:{pathname:t,search:i,hash:s,state:c}};let A=[];exports.NESTED_KEY="nested",exports.PERSISTED_KEY="persisted",exports.QUERYSTRING_CACHE_STATE_KEY=P,exports.Query=({options:e,history:s,children:a,replace:n,respect:i})=>{const c=r.useMemo(()=>{const r=H(e);return{history:s,queryStore:r,resolvePath:t(Y).call(Y,null,r)}},[s,e]),[,o]=r.useState(null);return r.useEffect(()=>s.listen(({pathname:e,search:t,hash:r,state:a})=>{let u=!1,l={...a};if(!l[P]){const e=c.queryStore.parseQueryString(t);l={...c.queryStore.createStateObject({respect:i,foreign:!0,mutations:[{add:e}]})},u=n||!1}if(l[P].replaced||c.queryStore.add({pathname:e,state:l}),u){const{path:t,state:a}=c.resolvePath({pathname:e,hash:r,state:{[P]:{replaced:!0}}},{stringify:!0});s.replace(t,a)}else o(l)}),[c,s,n,i]),r.createElement(T.Provider,{value:{...c}},a)},exports.QueryContext=T,exports.QueryLink=({children:e,pathname:t,hash:s,state:a,mutations:n,stringify:i,...c})=>{const{resolvePath:o}=r.useContext(T);return e({...c,path:o({pathname:t,hash:s,mutations:n,state:a},{stringify:i})})},exports.QueryParams=({children:e,scope:t,params:s})=>{const{history:a,queryStore:n}=r.useContext(T);if(!i(A).call(A,t)&&(A.push(t),s.length&&a.location.search)){var c;const e=n.parseQueryString(a.location.search),r=h(c=l(e)).call(c,(t,r)=>i(s).call(s,r)?{...t,[r]:e[r]}:t,{});n.add({pathname:t,state:{...n.createStateObject({match:!0,mutations:[{add:r}]})}})}return e},exports.SHADOW_KEY=q,exports.addQueryParams=Q,exports.createQueryStore=H,exports.removeQueryParams=S;
