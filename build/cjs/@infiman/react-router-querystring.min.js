function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=e(require("@babel/runtime-corejs3/core-js-stable/instance/bind")),r=e(require("react")),s=e(require("@babel/runtime-corejs3/core-js-stable/object/create")),a=e(require("@babel/runtime-corejs3/core-js-stable/object/assign")),n=e(require("@babel/runtime-corejs3/core-js-stable/json/stringify")),c=e(require("@babel/runtime-corejs3/core-js-stable/instance/includes")),i=e(require("@babel/runtime-corejs3/core-js-stable/instance/filter")),o=e(require("@babel/runtime-corejs3/core-js-stable/instance/flat-map")),u=e(require("@babel/runtime-corejs3/core-js-stable/instance/for-each")),l=e(require("@babel/runtime-corejs3/core-js-stable/object/keys")),h=e(require("@babel/runtime-corejs3/core-js-stable/instance/reduce")),y=e(require("@babel/runtime-corejs3/core-js-stable/symbol")),p=e(require("@babel/runtime-corejs3/core-js-stable/array/is-array")),d=e(require("fast-memoize"));const b=e=>e&&"object"==typeof e&&("function"!=typeof e.constructor||"Object"===e.constructor.name),m=(e,t,r)=>((e,t,r)=>{const s=p(t)?t:[t];let n=e;return u(s).call(s,t=>{if(!b(t))return;const s=l(t);u(s).call(s,s=>{const c=Object.hasOwnProperty.call(e,s),i=e[s],o=t[s],u=r?r(i,o,s):o;c&&u===i||(n===e&&(n=a({},e)),n[s]=u)})}),n})(e,t,(e,t,s)=>b(e)&&b(t)?m(e,t,r):r?r(e,t,s):t),j=e=>{const[t,...r]=e.split("/");return r[0]||(r[0]="/"),r},f=e=>d((t,r)=>m(t,r,e)),S=f((e,t)=>p(e)&&p(t)?[...e,...t]:t),g=f((e,t)=>p(e)&&p(t)?i(e).call(e,(e,r)=>!c(t).call(t,e)):t),q=(e,t,r)=>{const s=Object.prototype.hasOwnProperty.call(e,t),n=e[t],c=r(n,t,{tail:!0});return s&&n===c?e:a({},e,{[t]:c})},Q="@@__QUERYSTRING_CACHE_STATE_OBJECT__@@",E=y("shadow"),v=()=>Math.random().toString(36).substr(2,7),x=e=>({nested:{},persisted:{},[E]:{},...e}),O=({mutations:e,...t}={})=>({[Q]:{...t,key:v(),mutations:e||[]}}),P=(e,[t,...r]=[],s=[])=>{if(t){const a=e["*"],n=e[t];return a&&a.mutated&&s.push(a),n&&n.mutated&&s.push(n),n?P(n.nested,r,s):s}return s},_=(e,t=[])=>h(t).call(t,(t,r)=>({...t,[r]:{...e[r],[E]:{},nested:_(e[r].nested,l(e[r].nested))}}),{...e}),C={get cache(){return this.history[this.currentHistoryKey]},set cache(e){this.history[this.currentHistoryKey]=e},add({pathname:e="",state:t}){const{key:r,mutations:s,foreign:n,respect:h,match:y}=t[Q];if(Object.prototype.hasOwnProperty.call(this.history,r))return this.currentHistoryKey=r,this;let p=this.cache;var d;(u(s).call(s,({scope:t,persist:r,add:s,remove:c})=>{var i;p=((e,t,r,s)=>{let n,c=s||(()=>({})),i=a({},e),o=i;for(let s=0,i=t.length;s<i;s++)if(s===i-1){if(!n)return q(e,t[s],r);{const a=q(o,t[s],r);if(o===a)return e;n[t[s-1]]=a}}else{const e=r(o[t[s]]?o[t[s]]:c(t[s]),t[s],{tail:!1});o[t[s]]=a({},e),n=o,o=o[t[s]]}return i})(p,o(i=j(t||e)).call(i,(e,t,{length:r})=>t<r-1?[e,"nested"]:e),(e,t,{tail:a})=>{if(a){const a=e||x({path:t,mutated:!0});if(n)return{...a,persisted:h?a.persisted:{},[E]:h?s:{},nested:_(a.nested,l(a.nested))};{const e=r?"persisted":E;let t=a[e];return c&&(t=g(t,c)),s&&(t=S(t,s)),{...a,[e]:t,nested:y?a.nested:_(a.nested,l(a.nested))}}}return n&&!h&&"nested"!==t?x({path:t,nested:e.nested}):e},e=>"nested"===e?{}:x({path:e}))}),y)||(p=_(p,i(d=l(p)).call(d,t=>{var r;return!c(r=["*",j(e)[0]]).call(r,t)})));return this.currentHistoryKey=r,this.cache=p,this},resolveQueryString(e="",t=[]){const r=P(this.cache,j(e));let s=h(r).call(r,(e,t)=>S(e,{...t[E],...t.persisted}),{});return u(t).call(t,({add:e,remove:t})=>{t&&(s=g(s,t)),e&&(s=S(s,e))}),this.stringifyQueryParams(s)},clear(){return this.history={},this.currentHistoryKey=v(),this.cache={},this},toString(){return n(this.cache)}};let K;const H=({initialCache:e,parseQueryString:t,stringifyQueryParams:r}={})=>{if(!K){const n=v();K=a(s(a(C,{createStateObject:O,parseQueryString:t,stringifyQueryParams:r})),{currentHistoryKey:n,history:{[n]:e||{}}})}return K},T=r.createContext({}),Y=(e,{pathname:t,mutations:r,hash:s,state:a={}},{stringify:n})=>{const c=e.resolveQueryString(t,r),i={...a,...e.createStateObject({mutations:r,...a[Q]})};return n?{path:`${t}${c}${s}`,state:i}:{pathname:t,search:c,hash:s,state:i}};let A=[];exports.NESTED_KEY="nested",exports.PERSISTED_KEY="persisted",exports.QUERYSTRING_CACHE_STATE_KEY=Q,exports.Query=({options:e,history:s,children:a,replace:n,respect:c})=>{const i=r.useMemo(()=>{const r=H(e);return{history:s,queryStore:r,resolvePath:t(Y).call(Y,null,r)}},[s,e]),[,o]=r.useState(null);return r.useEffect(()=>s.listen(({pathname:e,state:t,search:r})=>{let a=!1,u={...t};if(!u[Q]){const e=i.queryStore.parseQueryString(r);u={...i.queryStore.createStateObject({respect:c,foreign:!0,mutations:[{add:e}]})},a=n||!1}u[Q].replaced||i.queryStore.add({pathname:e,state:u}),a?s.replace(`${e}${i.queryStore.resolveQueryString(e)}`,{...u,[Q]:{...u[Q],replaced:!0}}):o(u)}),[i,s,n,c]),r.createElement(T.Provider,{value:{...i}},a)},exports.QueryContext=T,exports.QueryLink=({children:e,pathname:t,hash:s,state:a,mutations:n,stringify:c,...i})=>{const{resolvePath:o}=r.useContext(T);return e({...i,path:o({pathname:t,hash:s,mutations:n,state:a},{stringify:c})})},exports.QueryParams=({children:e,scope:t,params:s})=>{const{history:a,queryStore:n}=r.useContext(T);if(!c(A).call(A,t)&&(A.push(t),s.length&&a.location.search)){var i;const e=n.parseQueryString(a.location.search),r=h(i=l(e)).call(i,(t,r)=>c(s).call(s,r)?{...t,[r]:e[r]}:t,{});n.add({pathname:t,state:{...n.createStateObject({match:!0,mutations:[{add:r}]})}})}return e},exports.SHADOW_KEY=E,exports.addQueryParams=S,exports.createQueryStore=H,exports.removeQueryParams=g;
